"use strict";(self["webpackChunkbamxx"]=self["webpackChunkbamxx"]||[]).push([[164],{5164:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Te});var a=s(3673);function o(e,t,s,o,i,n){const r=(0,a.up)("AbsenceTable"),l=(0,a.up)("JustificationTable"),c=(0,a.up)("JustifyAbsence"),u=(0,a.up)("q-dialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(r,{absenceTable:{absences:i.absences},search:!0,onJustifyModal:n.justify,csv:!0,xls:!0},null,8,["absenceTable","onJustifyModal"]),(0,a.Wm)(l,{justificationTable:{justifications:i.justifications},search:!0,csv:!0,xls:!0},null,8,["justificationTable"]),(0,a.Wm)(u,{modelValue:o.justifyModal,"onUpdate:modelValue":t[0]||(t[0]=e=>o.justifyModal=e),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{beneficiary:i.beneficiary,onJustifyAbsence:n.justifyBeneficiary},null,8,["beneficiary","onJustifyAbsence"])])),_:1},8,["modelValue"])],64)}var i=s(5474),n=s(1959),r=s(6249),l=s(2323);const c={class:"q-pa-md text-uppercase"},u=(0,a.Uk)(" Activo "),d=(0,a.Uk)(" Inactivo "),p={key:0},f={key:1},m={key:0},b={key:1},h=(0,a.Uk)(" Editar "),w={class:"col q-pa-md q-gutter-sm"};function y(e,t,s,o,i,n){const r=(0,a.up)("q-td"),y=(0,a.up)("q-badge"),g=(0,a.up)("q-tooltip"),k=(0,a.up)("q-btn"),j=(0,a.up)("q-tr"),q=(0,a.up)("q-icon"),_=(0,a.up)("q-input"),v=(0,a.up)("q-table");return(0,a.wg)(),(0,a.iD)("div",c,[(0,a.Wm)(v,{"title-class":"title",title:"Registro de faltas del mes",rows:i.rows,filter:i.filter,grid:e.$q.screen.xs,"no-data-label":"Sin información disponible","no-results-label":"Sin coincidencias",columns:o.columns,"row-key":"name",flat:"",bordered:""},{body:(0,a.w5)((e=>[(0,a.Wm)(j,{props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{key:"Id",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.Id),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"name",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.name),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"groupName",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.groupName),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"communityName",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.communityName),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"status",props:e},{default:(0,a.w5)((()=>["active"==e.row.status?((0,a.wg)(),(0,a.j4)(y,{key:0,color:"green"},{default:(0,a.w5)((()=>[u])),_:1})):((0,a.wg)(),(0,a.j4)(y,{key:1,color:"red"},{default:(0,a.w5)((()=>[d])),_:1}))])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"address",props:e},{default:(0,a.w5)((()=>[e.row.address?((0,a.wg)(),(0,a.iD)("div",p,(0,l.zw)(e.row.address),1)):((0,a.wg)(),(0,a.iD)("div",f," No disponible"))])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"phone",props:e},{default:(0,a.w5)((()=>[e.row.phone?((0,a.wg)(),(0,a.iD)("div",m,(0,l.zw)(e.row.phone),1)):((0,a.wg)(),(0,a.iD)("div",b," No disponible"))])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"absencesOfMonth",props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{style:(0,l.j5)({background:n.computedColor(e.row.absencesOfMonth)})},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.absencesOfMonth),1)])),_:2},1032,["style"])])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"actions",props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{flat:"",round:"",color:"gray",icon:"edit",onClick:t=>n.justifyAbsence(e.row)},{default:(0,a.w5)((()=>[(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[h])),_:1})])),_:2},1032,["onClick"])])),_:2},1032,["props"])])),_:2},1032,["props"])])),"top-right":(0,a.w5)((()=>[(0,a._)("div",w,[s.xls?((0,a.wg)(),(0,a.j4)(k,{key:0,color:"green-9","icon-right":"description",label:"Descargar xls","no-caps":"",onClick:t[0]||(t[0]=e=>n.exportTable(!0))})):(0,a.kq)("",!0),s.csv?((0,a.wg)(),(0,a.j4)(k,{key:1,color:"yellow-8","icon-right":"archive",label:"Descargar csv","no-caps":"",onClick:t[1]||(t[1]=e=>n.exportTable(!1))})):(0,a.kq)("",!0),s.reports?((0,a.wg)(),(0,a.j4)(k,{key:2,color:"blue-9","icon-right":"summarize",label:"Generar Reporte","no-caps":""})):(0,a.kq)("",!0)]),s.search?((0,a.wg)(),(0,a.j4)(_,{key:0,borderless:"",dense:"",debounce:"300",modelValue:i.filter,"onUpdate:modelValue":t[2]||(t[2]=e=>i.filter=e),placeholder:"Buscar"},{append:(0,a.w5)((()=>[(0,a.Wm)(q,{name:"search"})])),_:1},8,["modelValue"])):(0,a.kq)("",!0)])),_:1},8,["rows","filter","grid","columns"])])}var g=s(2841);s(1082);function k(e,t,s){let a=void 0!==t?t(e,s):e;return a=void 0===a||null===a?"":String(a),a=a.split('"').join('""'),`"${a}"`}const j=[{name:"Id",required:!0,align:"left",label:"Folio",field:"Id",sortable:!0},{name:"name",align:"left",label:"Nombre",field:"name",sortable:!0},{name:"groupName",align:"left",label:"Grupo",field:"groupName",sortable:!0},{name:"communityName",align:"left",label:"Comunidad",field:"communityName"},{name:"address",align:"left",label:"Dirección",field:"address",sortable:!0},{name:"phone",align:"left",label:"Teléfono",field:"phone",sortable:!1},{name:"absencesOfMonth",align:"center",label:"Faltas",field:"absencesOfMonth",sortable:!0},{name:"actions",label:"Acciones",field:"acciones",sortable:!0}],q={name:"AbsenceTable",props:{absenceTable:{type:Object,required:!0},csv:Boolean,xls:Boolean,search:Boolean,reports:Boolean,importBtn:Boolean,buttons:Boolean,info:Boolean,buttonIcon:String},mounted(){this.rows=this.$props.absenceTable.absences},data(){return{filter:(0,n.iH)(""),rows:[]}},setup(){return{columns:j}},methods:{computedColor:function(e){e>3&&(e=3);let t=["#ffffff","#fdb913","#ff7b00","#ff0000"];return t[e]},justifyAbsence(e){this.$emit("justify-modal",e)},exportTable(e){const t=[this.columns.map((e=>k(e.label)))].concat(this.rows.map((e=>this.columns.map((t=>k("function"===typeof t.field?t.field(e):e[void 0===t.field?t.name:t.field],t.format,e))).join(",")))).join("\r\n");let s=!0===e?"registro de faltas.xls":"registro de faltas.csv",a=!0===e?"text/xsl":"text/csv";const o=(0,g.Z)(s,t,a);!0!==o&&$q.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}},beforeUpdate(){this.rows=this.$props.absenceTable.absences}};var _=s(4260),v=s(9178),x=s(8186),D=s(3884),W=s(9721),A=s(8240),B=s(8870),Z=s(4689),T=s(4554),$=s(7518),N=s.n($);const I=(0,_.Z)(q,[["render",y]]),U=I;N()(q,"components",{QTable:v.Z,QTr:x.Z,QTd:D.Z,QBadge:W.Z,QBtn:A.Z,QTooltip:B.Z,QInput:Z.Z,QIcon:T.Z});const z={class:"full-width row justify-between q-py-lg q-px-xl"},Q={class:"col-11 flex"},C=(0,a._)("span",{class:"dialog__title q-my-auto q-pl-md text-h5"}," Justificar faltas ",-1),J={class:"col-1 flex"},M={class:"q-px-md"},O={class:"q-py-md"},S={class:"q-px-md q-py-sm"},V=(0,a._)("span",{class:"text-h6"}," Nombre: ",-1),F=(0,a.Uk)(),H={class:"q-pl-sm"},G={class:"q-px-md q-py-sm"},R=(0,a._)("span",{class:"text-h6"}," Folio: ",-1),E=(0,a.Uk)(),Y={class:"q-pl-sm"},K={class:"q-px-md q-py-sm"},P=(0,a._)("span",{class:"text-h6"}," Comunidad: ",-1),L=(0,a.Uk)(),X={class:"q-pl-sm"},ee=(0,a._)("div",{class:"q-px-md q-py-sm text-center"},[(0,a._)("span",{class:"text-h6"}," Faltas registradas ")],-1),te={key:0};function se(e,t,s,o,i,n){const r=(0,a.up)("q-icon"),c=(0,a.up)("q-btn"),u=(0,a.up)("Absence"),d=(0,a.up)("q-form"),p=(0,a.up)("q-card-section"),f=(0,a.up)("q-card"),m=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(f,{class:"dialog full-width column"},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{class:"full-width column"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a._)("div",z,[(0,a._)("div",Q,[(0,a.Wm)(r,{name:"how_to_reg",size:"300%"}),C]),(0,a._)("div",J,[(0,a.wy)((0,a.Wm)(c,{class:"q-ml-auto",size:"md",icon:"cancel",flat:"",round:""},null,512),[[m]])])]),(0,a._)("div",M,[(0,a._)("div",O,[(0,a._)("div",S,[V,F,(0,a._)("span",H,(0,l.zw)(s.beneficiary.name),1)]),(0,a._)("div",G,[R,E,(0,a._)("span",Y,(0,l.zw)(s.beneficiary.Id),1)]),(0,a._)("div",K,[P,L,(0,a._)("span",X,(0,l.zw)(s.beneficiary.communityName),1)])]),ee,0==i.absences.length?((0,a.wg)(),(0,a.iD)("div",te," No hay faltas que mostrar ")):((0,a.wg)(!0),(0,a.iD)(a.HY,{key:1},(0,a.Ko)(i.absences,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.Id},[(0,a.Wm)(u,{absence:e,justifications:i.justifications,onJustifyAbsence:n.justify},null,8,["absence","justifications","onJustifyAbsence"])])))),128))])])),_:1})])),_:1})])),_:1})}const ae={class:"row q-py-md"},oe={class:"col-12 col-sm-4 flex justify-center"},ie={class:"q-my-auto"},ne={class:"col-12 col-sm-3 flex justify-center"},re={class:"col-12 col-sm-5 flex justify-center"};function le(e,t,s,o,i,n){const r=(0,a.up)("q-select"),c=(0,a.up)("q-btn");return(0,a.wg)(),(0,a.iD)("div",ae,[(0,a._)("div",oe,[(0,a._)("span",ie,(0,l.zw)(s.absence.formattedDate),1)]),(0,a._)("div",ne,[(0,a.Wm)(r,{borderless:"",modelValue:o.select,"onUpdate:modelValue":t[0]||(t[0]=e=>o.select=e),"stack-label":"",options:i.options},null,8,["modelValue","options"])]),(0,a._)("div",re,[(0,a.Wm)(c,{flat:"",label:"Justificar",icon:"check",color:"green",class:"q-my-auto",onClick:t[1]||(t[1]=e=>n.justify())})])])}const ce={name:"Absence",props:{absence:Object,justifications:Object},data(){return{options:[]}},setup(){return{select:(0,n.iH)("Selecciona...")}},methods:{success(e){this.$q.notify({message:e,icon:"done",color:"green"})},error(e){this.$q.notify({message:e,icon:"error",color:"red"})},justify(){let e;if("Selecciona..."==this.select)e=1;else{const t=this.justifications.findIndex((e=>this.select===e.description));e=this.justifications[t].id}const t={id:this.absence.id,justificationTypeId:e,authorizedBy:this.$store.getters.id};i.api.post("api/justification/create",t,{headers:{"x-access-token":this.$store.getters.token}}).then((e=>{this.success("Falta justificada correctamente"),this.$emit("justify-absence",this.absence)})).catch((e=>{this.error("Hubo un error al justificar la falta. Inténtelo de nuevo.")}))}},updated(){this.justifications.forEach((e=>{this.options.push(e.description)}))}};var ue=s(5863);const de=(0,_.Z)(ce,[["render",le]]),pe=de;N()(ce,"components",{QSelect:ue.Z,QBtn:A.Z});const fe={name:"JustifyAbsence",components:{Absence:pe},props:{beneficiary:Object},data(){return{absences:[],justifications:{}}},methods:{getAbsences(){i.api.get("api/attendance/absence/"+this.beneficiary.Id,{headers:{"x-access-token":this.$store.getters.token}}).then((e=>{this.absences=e.data,this.absences.forEach((e=>{e.formattedDate=e.date.substr(8,2)+"/"+e.date.substr(5,2)+"/"+e.date.substr(0,4)}))})).catch((e=>{this.error(e.response.data.Message)}))},getJustifications(){i.api.get("api/justificationType",{headers:{"x-access-token":this.$store.getters.token}}).then((e=>{this.justifications=e.data})).catch((e=>{this.error(e.response.data.Message)}))},justify(e){let t=this.absences.findIndex((t=>t.id===e.id));this.absences.splice(t,1),this.$emit("justify-absence",this.beneficiary)}},beforeMount(){this.getAbsences(),this.getJustifications()}};var me=s(151),be=s(5589),he=s(8689),we=s(677);const ye=(0,_.Z)(fe,[["render",se]]),ge=ye;N()(fe,"components",{QCard:me.Z,QCardSection:be.Z,QForm:he.Z,QIcon:T.Z,QBtn:A.Z}),N()(fe,"directives",{ClosePopup:we.Z});const ke={class:"q-pa-md text-uppercase"},je={class:"col q-pa-sm q-gutter-sm"};function qe(e,t,s,o,i,n){const r=(0,a.up)("q-td"),c=(0,a.up)("q-tr"),u=(0,a.up)("q-btn"),d=(0,a.up)("q-icon"),p=(0,a.up)("q-input"),f=(0,a.up)("q-table");return(0,a.wg)(),(0,a.iD)("div",ke,[(0,a.Wm)(f,{"title-class":"title",title:"Registro de justificaciones del mes",rows:i.rows,filter:i.filter,grid:e.$q.screen.xs,"no-data-label":"Sin información disponible","no-results-label":"Sin coincidencias",columns:o.columns,"row-key":"name",flat:"",bordered:""},{body:(0,a.w5)((e=>[(0,a.Wm)(c,{props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{key:"familyId",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.familyId),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"name",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.name),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"groupName",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.groupName),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"communityName",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.communityName),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"abstenceDate",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.abstenceDate),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"justificationDate",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.justificationDate),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"description",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.description),1)])),_:2},1032,["props"]),(0,a.Wm)(r,{key:"justifiedBy",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.row.justifiedBy),1)])),_:2},1032,["props"])])),_:2},1032,["props"])])),"top-right":(0,a.w5)((()=>[(0,a._)("div",je,[s.xls?((0,a.wg)(),(0,a.j4)(u,{key:0,color:"green-9","icon-right":"description",label:"Descargar xls","no-caps":"",onClick:t[0]||(t[0]=e=>n.exportTable(!0))})):(0,a.kq)("",!0),s.csv?((0,a.wg)(),(0,a.j4)(u,{key:1,color:"yellow-8","icon-right":"archive",label:"Descargar csv","no-caps":"",onClick:t[1]||(t[1]=e=>n.exportTable(!1))})):(0,a.kq)("",!0),s.reports?((0,a.wg)(),(0,a.j4)(u,{key:2,color:"blue-9","icon-right":"summarize",label:"Generar Reporte","no-caps":"",onClick:t[2]||(t[2]=t=>e.console.log("Generar Reporte"))})):(0,a.kq)("",!0)]),s.search?((0,a.wg)(),(0,a.j4)(p,{key:0,borderless:"",dense:"",debounce:"300",modelValue:i.filter,"onUpdate:modelValue":t[3]||(t[3]=e=>i.filter=e),placeholder:"Buscar"},{append:(0,a.w5)((()=>[(0,a.Wm)(d,{name:"search"})])),_:1},8,["modelValue"])):(0,a.kq)("",!0)])),_:1},8,["rows","filter","grid","columns"])])}function _e(e,t,s){let a=void 0!==t?t(e,s):e;return a=void 0===a||null===a?"":String(a),a=a.split('"').join('""'),`"${a}"`}const ve=[{name:"familyId",required:!0,align:"left",label:"Folio",field:"familyId",sortable:!0},{name:"name",align:"left",label:"Nombre",field:"name",sortable:!0},{name:"groupName",align:"left",label:"Grupo",field:"groupName",sortable:!0},{name:"communityName",align:"left",label:"Comunidad",field:"communityName"},{name:"abstenceDate",align:"left",label:"Día de falta",field:"abstenceDate",sortable:!0},{name:"justificationDate",align:"left",label:"Día de justificación",field:"justificationDate",sortable:!1},{name:"description",align:"center",label:"Descripción",field:"description",sortable:!0},{name:"justifiedBy",label:"Justificado por",field:"justifiedBy",sortable:!0}],xe={name:"JustificationTable",props:{justificationTable:{type:Object,required:!0},csv:Boolean,xls:Boolean,search:Boolean,reports:Boolean,importBtn:Boolean,buttons:Boolean,info:Boolean,buttonIcon:String},mounted(){this.rows=this.$props.justificationTable.justifications},data(){return{filter:(0,n.iH)(""),rows:[]}},setup(){return{columns:ve}},methods:{computedColor:function(e){e>3&&(e=3);let t=["#ffffff","#fdb913","#ff7b00","#ff0000"];return t[e]},exportTable(e){const t=[this.columns.map((e=>_e(e.label)))].concat(this.rows.map((e=>this.columns.map((t=>_e("function"===typeof t.field?t.field(e):e[void 0===t.field?t.name:t.field],t.format,e))).join(",")))).join("\r\n");let s=!0===e?"registro de faltas.xls":"registro de faltas.csv",a=!0===e?"text/xsl":"text/csv";const o=(0,g.Z)(s,t,a);!0!==o&&$q.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}},beforeUpdate(){this.rows=this.$props.justificationTable.justifications}},De=(0,_.Z)(xe,[["render",qe]]),We=De;N()(xe,"components",{QTable:v.Z,QTr:x.Z,QTd:D.Z,QBtn:A.Z,QInput:Z.Z,QIcon:T.Z});const Ae={name:"Attendences",components:{AbsenceTable:U,JustifyAbsence:ge,JustificationTable:We},data(){return{beneficiary:{},tempAttendace:{},tempAbsence:{},absences:[],justifications:[],cols:["Folio","Nombre","Comunidad","Grupo","Fecha de asistencia","Atendido por"],rows:[]}},setup(){return{justifyModal:(0,n.iH)(!1)}},methods:{justify(e){this.beneficiary=e,this.justifyModal=!0},justifyBeneficiary(e){let t=this.absences.findIndex((t=>t.Id===e.Id));this.absences[t].absencesOfMonth>1?this.absences[t].absencesOfMonth--:this.absences.splice(t,1)},getJustifications(){i.api.get("api/justification/",{headers:{"x-access-token":this.$store.getters.token}}).then((e=>{e.data.forEach((e=>{e.justificationDate&&(e.justificationDate=e.justificationDate.substr(8,2)+"/"+e.justificationDate.substr(5,2)+"/"+e.justificationDate.substr(0,4)+" - "+e.justificationDate.substr(11,5)),e.abstenceDate&&(e.abstenceDate=e.abstenceDate.substr(8,2)+"/"+e.abstenceDate.substr(5,2)+"/"+e.abstenceDate.substr(0,4)+" - "+e.abstenceDate.substr(11,5)),this.justifications.push(e)}))})).catch((e=>{401==e.response.status?(this.$store.commit("updateAuth",{auth:!1}),this.$router.push("login")):this.error(e.response.data.Message)}))},getAbsences(){r.Z.show(),i.api.get("api/attendance/absence/",{headers:{"x-access-token":this.$store.getters.token}}).then((e=>{e.data.forEach((e=>{this.absences.push(e)})),r.Z.hide()})).catch((e=>{r.Z.hide(),401==e.response.status&&(this.$store.commit("updateAuth",{auth:!1}),this.$router.push("login"))}))},getRecentAttendances(){i.api.get("api/attendance/recent",{headers:{"x-access-token":this.$store.getters.token}}).then((e=>{e.data.forEach((e=>{this.tempAttendace={Folio:e.familyId,Nombre:e.familyName,Grupo:e.groupName,Comunidad:e.communityName,"Fecha de asistencia":e.date.substr(8,2)+"/"+e.date.substr(5,2)+"/"+e.date.substr(0,4)+" - "+e.date.substr(11,5),"Atendido por":e.attendedBy},this.rows.push(this.tempAttendace)}))})).catch((e=>{401==e.response.status&&(this.$store.commit("updateAuth",{auth:!1}),this.$router.push("login")),404==e.response.status&&this.$q.notify({message:"Hubo un error al recuperar la informacion de las asistencias",icon:"error",color:"red"})}))}},mounted(){this.getAbsences(),this.getRecentAttendances(),this.getJustifications()}};var Be=s(6778);const Ze=(0,_.Z)(Ae,[["render",o]]),Te=Ze;N()(Ae,"components",{QDialog:Be.Z})}}]);